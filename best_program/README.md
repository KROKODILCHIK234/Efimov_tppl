# Надежная программа для получения данных по сети

Программа для непрерывного получения данных из двух источников и записи их в файл.

## Описание

Программа подключается к двум серверам и непрерывно получает данные:
- **Сервер 1** (95.163.237.76:5123): температура и давление
- **Сервер 2** (95.163.237.76:5124): координаты X, Y, Z

Все данные записываются в файл `data.txt` с временными метками в формате YYYY-MM-DD HH:MM:SS.

## Требования

- Lua 5.1 или выше
- Библиотека luasocket

### Установка зависимостей

#### Ubuntu/Debian:
```bash
sudo apt-get install lua5.1 lua-socket
```

#### Используя LuaRocks:
```bash
luarocks install luasocket
```

#### macOS (Homebrew):
```bash
brew install lua
luarocks install luasocket
```

## Запуск программы

### Основной запуск:
Программу можно запускать из любой директории. Рекомендуется запускать из корневой директории проекта:
```bash
cd /path/to/reliable_program
lua best_program/main.lua
```

Или из директории best_program:
```bash
cd best_program
lua main.lua
```

### Запуск с указанием хоста:
```bash
lua best_program/main.lua 95.163.237.76
```

**Примечание:** Файл `data.txt` будет создан в той же директории, где находится скрипт `main.lua`.

### Остановка программы:
Нажмите `Ctrl+C` для корректного завершения программы. Все соединения будут закрыты, файл будет сохранен.

## Структура проекта

```
best_program/
├── main.lua          # Основной файл программы
├── connection.lua    # Модуль для работы с сетевыми соединениями
├── protocol.lua      # Модуль для парсинга протокола данных
├── mock_server.lua   # Тестовый сервер для локального тестирования
├── test_protocol.lua # Тесты для модуля protocol
└── README.md         # Этот файл
```

## Формат выходных данных

Данные записываются в файл `data.txt` в следующем формате:

```
2024-12-15 10:30:45 Server1 Temp: 25.50, Pressure: 100
2024-12-15 10:30:46 Server2 X: 1, Y: 2, Z: 3
```

## Тестирование

### Запуск тестов протокола:
Для запуска тестов требуется установленный busted:
```bash
luarocks install busted
cd best_program
busted test_protocol.lua
```

### Локальное тестирование с mock-сервером:
1. В первом терминале запустите mock-сервер:
```bash
cd best_program
lua mock_server.lua
```

2. Во втором терминале запустите программу с локальным хостом (из корневой директории):
```bash
lua best_program/main.lua 127.0.0.1
```

## Особенности реализации

- **Отказоустойчивость**: Автоматическое переподключение при разрыве соединения
- **Проверка контрольной суммы**: Все пакеты проверяются на корректность
- **Буферизация**: Корректная обработка частично полученных данных
- **Неблокирующие операции**: Использование неблокирующих сокетов для максимальной производительности
- **Корректное завершение**: Обработка сигналов для безопасного закрытия соединений

## Проверка работы

Программа была протестирована на непрерывной работе более 20 минут с успешным получением данных от обоих серверов.

