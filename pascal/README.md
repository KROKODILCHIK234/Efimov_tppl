# Интерпретатор упрощенного языка Pascal

Интерпретатор для упрощенной версии языка Pascal, разработанный на основе кода с практических занятий.

## Описание задания

На основе кода с практических занятий разработать интерпретатор для упрощенной версии языка Pascal.

Интерпретатор должен выдавать значение всех переменных используемых в программе, например, в виде словаря.

## Требования

- Должны быть написаны тесты для проверки всего кода
- Код реализован на языке Lua
- Решение располагается в директории `pascal`

## Структура проекта

```
pascal/
├── interpreter.lua        # Основной файл интерпретатора
├── interpreter_spec.lua    # Автоматические тесты (busted)
├── test_manual.lua         # Ручные тесты
└── README.md              # Этот файл
```

## Установка зависимостей

Для запуска тестов требуется установленный `busted`:

```bash
luarocks install busted
```

## Использование

### Базовое использование

```lua
local interpreter = require('interpreter')

local code = [[
BEGIN
    x := 2 + 3 * (2 + 3);
    y := 2 / 2 - 2 + 3 * ((1 + 1) + (1 + 1));
END.
]]

local result = interpreter.interpret(code)
-- result будет содержать словарь с переменными:
-- { X = 17, Y = 11 }
```

### Примеры программ

#### Пример 1: Пустая программа

```pascal
BEGIN
END.
```

Результат: `{}` (пустой словарь)

#### Пример 2: Арифметические выражения

```pascal
BEGIN
    x := 2 + 3 * (2 + 3);
    y := 2 / 2 - 2 + 3 * ((1 + 1) + (1 + 1));
END.
```

Результат:
- `x = 17`
- `y = 11`

#### Пример 3: Вложенные блоки

```pascal
BEGIN
    y := 2;
    BEGIN
        a := 3;
        a := a;
        b := 10 + a + 10 * y / 4;
        c := a - b
    END;
    x := 11;
END.
```

Результат:
- `y = 2`
- `a = 3`
- `b = 18`
- `c = -15`
- `x = 11`

## Запуск тестов

### Автоматические тесты (busted)

```bash
cd pascal
busted interpreter_spec.lua
```

### Ручные тесты

```bash
cd pascal
lua test_manual.lua
```

## Грамматика языка

Интерпретатор поддерживает упрощенную версию Pascal со следующими возможностями:

- **Ключевые слова**: `BEGIN`, `END`
- **Операторы**: `+`, `-`, `*`, `/`
- **Присваивание**: `:=`
- **Переменные**: идентификаторы (буквы и цифры)
- **Числа**: целые числа
- **Вложенные блоки**: поддержка вложенных BEGIN-END блоков
- **Приоритет операций**: стандартный математический приоритет

## Особенности реализации

- Лексический анализ (Lexer) для разбора исходного кода
- Синтаксический анализ (Parser) для построения AST
- Интерпретатор для выполнения программы
- Поддержка вложенных блоков с правильной областью видимости переменных
- Обработка арифметических выражений с учетом приоритета операций

## Формат вывода

Интерпретатор возвращает таблицу (словарь) Lua, где ключи - это имена переменных в верхнем регистре, а значения - вычисленные числовые значения.

Пример:
```lua
{
    X = 17,
    Y = 11,
    A = 3,
    B = 18,
    C = -15
}
```

## Проверка работоспособности

Для проверки работоспособности можно использовать следующие блоки кода:

1. **Пустая программа:**
```pascal
BEGIN
END.
```

2. **Сложные выражения:**
```pascal
BEGIN
    x := 2 + 3 * (2 + 3);
    y := 2 / 2 - 2 + 3 * ((1 + 1) + (1 + 1));
END.
```

3. **Вложенные блоки:**
```pascal
BEGIN
    y := 2;
    BEGIN
        a := 3;
        a := a;
        b := 10 + a + 10 * y / 4;
        c := a - b
    END;
    x := 11;
END.
```

## Описание грамматики

Описание грамматики можно найти в прикрепленном файле `pascal.xhtml.txt` (для просмотра удалить из имени `.txt`).

